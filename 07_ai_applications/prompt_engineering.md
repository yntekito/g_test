# プロンプトエンジニアリング（Prompt Engineering）

## 要点（試験用）
- **プロンプトエンジニアリング**：生成AI（ChatGPT等）に望ましい出力を得るため、指示文（プロンプト）を設計・最適化する技術。
- 具体的な指示、文脈提供、出力形式の指定、Few-shot学習（例示）等が効果的。
- LLM（大規模言語モデル）の性能を最大限引き出す実用技術として重要。

## 定義
**プロンプトエンジニアリング（Prompt Engineering）**は、ChatGPT・GPT-4・Claude等の生成AI（大規模言語モデル）に対して、望ましい出力を得るために入力する指示文（プロンプト）を設計・最適化する技術。適切なプロンプトにより、AIの応答品質・精度・有用性が大きく向上する。

**プロンプト（Prompt）**：AIに与える入力テキスト。質問・指示・文脈・例示などを含む。

## 重要キーワード
- **プロンプトエンジニアリング（Prompt Engineering）**：プロンプトの設計・最適化技術。
- **プロンプト（Prompt）**：AIへの入力指示文。
- **Zero-shot学習**：例示なしで指示のみで実行（「要約して」等）。
- **Few-shot学習（In-context Learning）**：少数の例示を与えて実行パターンを学習させる。
- **Chain-of-Thought（CoT）プロンプティング**：「ステップバイステップで考えて」等、思考過程を促す手法。推論タスクで有効。
- **システムプロンプト**：AIの役割・振る舞いを定義する初期設定（「あなたは専門家です」等）。
- **温度（Temperature）**：生成のランダム性を制御（0に近い=確定的、高い=創造的）。
- **Few-shot例示**：入力→出力の例を複数提示し、パターンを学習させる。
- **コンテキストウィンドウ**：AIが一度に処理できる最大トークン数（GPT-4: 8K～128K等）。
- **ハルシネーション（Hallucination）**：AIが事実でない情報を生成する現象。プロンプト設計で軽減可能。
- **役割指定（Role Prompting）**：「あなたは〇〇の専門家です」と役割を与える手法。
- **出力形式指定**：「箇条書きで」「JSON形式で」等、形式を明示。

## 詳細

### プロンプトエンジニアリングの目的
1. **精度向上**：正確で関連性の高い回答を得る
2. **制御性向上**：望む形式・トーン・詳細度で出力
3. **効率化**：一度の指示で目的達成
4. **ハルシネーション抑制**：誤情報生成を減らす

### 基本テクニック

#### 1. 明確で具体的な指示
```
❌ 悪い例: "AIについて教えて"
→ 曖昧で広範囲、回答が散漫

✅ 良い例: "AIの定義を3行で、初学者向けに説明してください"
→ 具体的な条件（長さ・対象者）を指定
```

#### 2. 役割指定（Role Prompting）
```
✅ "あなたはG検定の専門講師です。機械学習の基礎を初心者にわかりやすく説明してください。"

効果: 専門性と対象レベルの両方を明示
```

#### 3. 文脈提供
```
✅ "以下の前提で回答してください：
- 対象: 大学1年生
- 目的: レポート作成
- 制約: 数式は最小限
質問: 教師あり学習とは何ですか？"
```

#### 4. 出力形式の指定
```
✅ "以下の形式で出力してください：
1. 定義（50字以内）
2. 具体例（3つ）
3. 注意点（箇条書き）"

効果: 構造化された使いやすい出力
```

### 高度なテクニック

#### 1. Few-shot学習（例示）
```
✅ "以下の例に従って、感情分析を行ってください。

例1:
入力: この映画は最高だった！
出力: ポジティブ

例2:
入力: つまらなくて途中で寝た
出力: ネガティブ

入力: サービスが丁寧で満足
出力: ?"

→ AIがパターンを理解し「ポジティブ」と出力
```

#### 2. Chain-of-Thought（CoT）プロンプティング
```
✅ "次の問題をステップバイステップで考えて解いてください。

問題: りんご3個120円。5個買うといくら？

思考過程を示した後、最終回答を提示してください。"

効果: 推論の精度が向上（数学・論理問題で特に有効）
```

#### 3. ネガティブプロンプティング
```
✅ "機械学習を説明してください。
ただし、以下は避けてください：
- 専門用語の羅列
- 数式のみの説明
- 1000字以上の長文"

効果: 不要な出力を制約
```

#### 4. 制約条件の明示
```
✅ "以下の制約で説明してください：
- 文字数: 200字以内
- 対象: 小学生
- 禁止語: アルゴリズム、パラメータ
質問: AIとは何ですか？"
```

### プロンプトの構成要素

| 要素 | 説明 | 例 |
|------|------|-----|
| **役割** | AIに与える立場 | "あなたは医療専門家です" |
| **タスク** | 実行する作業 | "以下の症状を分類してください" |
| **文脈** | 背景情報 | "患者は50代男性、高血圧の既往あり" |
| **入力データ** | 処理対象 | "症状: 頭痛、めまい" |
| **制約** | 条件・制限 | "3つ以内の可能性を列挙" |
| **出力形式** | 形式指定 | "表形式で出力" |

### プロンプトの最適化プロセス
```
1. 初期プロンプト作成
   ↓
2. 出力を評価
   ↓
3. 問題点を特定（曖昧・冗長・不正確等）
   ↓
4. プロンプトを修正（具体化・制約追加・例示等）
   ↓
5. 再評価
   ↓
6. 繰り返し（満足する出力が得られるまで）
```

## 実例

### 例1：プロンプトの改善（要約タスク）
```
❌ 悪いプロンプト:
"この文章を要約して"

問題点: 長さ・重要度・形式が不明確

✅ 改善後:
"以下の文章を3行で要約してください。
- 対象読者: ビジネスパーソン
- 重視する情報: 結論と数値データ
- 形式: 箇条書き"

効果: 明確で使いやすい要約を取得
```

### 例2：Few-shot学習（データ分類）
```
プロンプト:
"以下の例に従って、問い合わせを分類してください。

例1:
入力: 商品が届かない
分類: 配送問題

例2:
入力: 返金したい
分類: 返品・返金

例3:
入力: 使い方がわからない
分類: 操作サポート

入力: パスワードを忘れた
分類: ?"

出力: アカウント管理
```

### 例3：Chain-of-Thought（数学問題）
```
プロンプト:
"以下の問題をステップバイステップで解いてください。

問題: 定価1000円の商品を20%引きで購入し、8%の消費税を支払った。支払総額は？

ステップ1: 割引後の価格
ステップ2: 消費税額
ステップ3: 支払総額"

出力:
ステップ1: 1000 × 0.8 = 800円
ステップ2: 800 × 0.08 = 64円
ステップ3: 800 + 64 = 864円
```

### 例4：役割指定の効果
```
❌ 通常のプロンプト:
"ディープラーニングを説明して"
→ 一般的な説明、対象不明確

✅ 役割指定あり:
"あなたはG検定の講師です。ディープラーニングを、AIの歴史的文脈を踏まえて、試験頻出ポイントを強調して説明してください。対象は初学者です。"
→ 試験対策に最適化された説明
```

## 試験での問われ方

### 典型問題
**問**: 「利用者が望ましい出力を得るために、ChatGPTなどのAIに対して指示や命令を設計、最適化すること」について、最も適切な選択肢を1つ選べ。

- ✅ **正解**: プロンプトエンジニアリング
- ❌ 誤答1: ファインチューニング（モデルの再訓練、プロンプト設計ではない）
- ❌ 誤答2: ハイパーパラメータチューニング（モデル訓練時のパラメータ調整）
- ❌ 誤答3: 転移学習（事前学習モデルの活用、プロンプト最適化ではない）
- ❌ 誤答4: データ拡張（訓練データの増加、指示設計ではない）

### 比較問題（違いのポイント）

| 技術 | 対象 | 変更内容 | コスト | 用途 |
|------|------|----------|--------|------|
| **プロンプトエンジニアリング** | 入力指示文 | プロンプトのみ | **極低** | 日常利用・即時対応 |
| ファインチューニング | モデル全体 | 重みの再訓練 | 高 | 専門タスク特化 |
| Few-shot学習 | 入力（例示） | プロンプト内の例 | 低 | パターン学習 |
| 転移学習 | モデル | 事前学習の活用 | 中 | ドメイン適応 |

### 引っ掛けポイント
1. **「モデルを再訓練」→ファインチューニング**（プロンプトエンジニアリングはモデル変更なし）
2. **「パラメータ調整」→ハイパーパラメータチューニング**（プロンプトは入力文の設計）
3. **「訓練データ準備」→データ拡張**（プロンプトは指示文の最適化）
4. **Few-shot学習との関係**：Few-shotはプロンプトエンジニアリングの一手法（混同注意）
5. **Zero-shot vs Few-shot**：Zero-shotは例示なし、Few-shotは例示あり（両方ともプロンプト技術）

### 関連用語の区別
```
【プロンプトエンジニアリング全体】
├─ Zero-shot: 例示なし（"要約して"）
├─ Few-shot: 例示あり（"例に従って分類して"）
└─ Chain-of-Thought: 思考過程を促す（"ステップバイステップで"）

【モデル変更を伴う技術】
├─ ファインチューニング: 重みの再訓練
├─ 転移学習: 事前学習の活用
└─ ハイパーパラメータチューニング: 学習設定の調整
```

### 実務観点の設問
- **問**: 追加コストなしでAIの出力品質を向上させる方法は？
  - → プロンプトエンジニアリング（モデル再訓練不要）
- **問**: 専門ドメインでAIを使う際の初期対応として適切なのは？
  - → プロンプトエンジニアリング（Few-shot例示）→ 効果不足ならファインチューニング検討

## 補足

### 実務上の注意点
1. **ハルシネーション対策**：「知らない場合は『わかりません』と答えて」と明示。
2. **プライバシー保護**：機密情報をプロンプトに含めない（AIが学習する可能性）。
3. **バイアス対策**：中立的な表現を使用（「男性エンジニア」→「エンジニア」）。
4. **プロンプトライブラリ**：効果的なプロンプトを組織で共有・再利用。
5. **コスト意識**：長すぎるプロンプトはトークン消費増→API利用料増加。

### プロンプトエンジニアリングの限界
- **モデルの知識範囲**：訓練データにない情報は引き出せない
- **複雑な推論**：数学・論理問題で誤答の可能性（CoTで改善可能）
- **一貫性**：同じプロンプトでも出力が変動（Temperature=0で緩和）
- **専門性**：高度な専門タスクはファインチューニングが必要な場合も

### 今後のトレンド
- **自動プロンプト最適化**：AIがプロンプトを自動改善
- **マルチモーダルプロンプト**：テキスト＋画像の統合指示
- **プロンプトチェーン**：複数のプロンプトを連鎖させて複雑タスク実行
- **プロンプトインジェクション対策**：悪意あるプロンプトからの防御

### 関連トピック
- [自然言語処理](natural_language_processing.md)：NLPの基礎技術
- [Transformer](../06_deep_learning/transformer.md)：GPT・BERT等のアーキテクチャ
- [生成モデル](../06_deep_learning/generative_models.md)：GANとの違い、生成AIの基礎
